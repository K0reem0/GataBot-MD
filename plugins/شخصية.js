let handler = async (m, { conn, text }) => {
  if (!text) return conn.reply(m.chat, '⚠️ اكتب اسم/رقم أو منشن أي شخص!', m)

  // نجيب المشاركين من القروب
  let participants = m.isGroup ? (await conn.groupMetadata(m.chat)).participants : []

  // إذا فيه منشن مباشر
  let target
  if (m.mentionedJid && m.mentionedJid.length) {
    target = m.mentionedJid[0]
  } else {
    // إذا كتب رقم/نص → ندور في أعضاء القروب بالـ lid
    let found = participants.find(p => text.includes(p.id.split('@')[0]))
    if (found) target = found.id
  }

  // لو ما حصلنا العضو
  if (!target) {
    target = m.sender // افتراضي: اللي أرسل
  }

  let display = '@' + target.split('@')[0]

  let personalidad = `
┓━━━━°❀❬ *شخصية* ❭❀°━━━━┏
*┃• أسم* : ${display}
*┃• معنويات جيدة* : ${pickRandom(['6%','12%','20%','27%','35%','41%','49%','54%','60%','66%','73%','78%','84%','92%','93%','94%','96%','98,3%','99,7%','99,9%','1%','2,9%','0%','0,4%'])}
*┃• الأخلاق السيئة* : ${pickRandom(['6%','12%','20%','27%','35%','41%','49%','54%','60%','66%','73%','78%','84%','92%','93%','94%','96%','98,3%','99,7%','99,9%','1%','2,9%','0%','0,4%'])}
*┃• نوعية الشخص* : ${pickRandom(['ذو قلب طيب','متعجرف','بخيل','سخي','متواضع','خجول','جبان','فضولي','زجاج','لا ثنائي الجنس XD (مصطلح للتعبير عن الهوية الجنسية)', 'احمق أو غبي'])}
*┃• دائمًا* : ${pickRandom(['ثقيل','ذو حظ سيء','مشتت الانتباه','مزعج','نمام','يضيع الوقت','يتسوق','يشاهد أنمي','يتحدث على واتساب لأنه أعزب','يستلقي دون فعل أي شيء مفيد','مميل للتعامل بشكل غير جدي مع النساء','على الهاتف المحمول'])}
*┃• ذكاء* : ${pickRandom(['6%','12%','20%','27%','35%','41%','49%','54%','60%','66%','73%','78%','84%','92%','93%','94%','96%','98,3%','99,7%','99,9%','1%','2,9%','0%','0,4%'])}
*┃• الأنحراف* : ${pickRandom(['6%','12%','20%','27%','35%','41%','49%','54%','60%','66%','73%','78%','84%','92%','93%','94%','96%','98,3%','99,7%','99,9%','1%','2,9%','0%','0,4%'])}
*┃• شجاعة* : ${pickRandom(['6%','12%','20%','27%','35%','41%','49%','54%','60%','66%','73%','78%','84%','92%','93%','94%','96%','98,3%','99,7%','99,9%','1%','2,9%','0%','0,4%'])}
*┃• يخاف* : ${pickRandom(['6%','12%','20%','27%','35%','41%','49%','54%','60%','66%','73%','78%','84%','92%','93%','94%','96%','98,3%','99,7%','99,9%','1%','2,9%','0%','0,4%'])}
*┃• شهرة* : ${pickRandom(['6%','12%','20%','27%','35%','41%','49%','54%','60%','66%','73%','78%','84%','92%','93%','94%','96%','98,3%','99,7%','99,9%','1%','2,9%','0%','0,4%'])}
*┃• جنس* : ${pickRandom(['رجل', 'امرأة', 'مثلي الجنس', 'ثنائي الجنسية', 'متعدد الجنسيات', 'نسوي', 'مستقيم', 'الذكورية القوية', 'امرأة قوية', 'مرتدة', 'توجه جنسي نحو الفول', 'توجه جنسي نحو بلاي ستيشن', 'السيدة مانويلا', 'توجه جنسي نحو الدجاج'])}
┛━━━━°❀❬ *تحليل* ❭❀°━━━━┗
`

  await conn.sendMessage(m.chat, { text: personalidad, mentions: [target] }, { quoted: m })
}

handler.help = ['personalidad *<nombre>*']
handler.tags = ['fun']
handler.command = /^personalidad|شخصيه|شخصية|الشخصيه|الشخصية/i

export default handler 

function pickRandom(list) {
  return list[Math.floor(Math.random() * list.length)]
}